"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var mapper_1 = require("../../mapper");
var operator_1 = require("../operator");
var instance_of_array_1 = require("./instance-of-array");
var string_util_1 = require("../../string-util");
function array(f) {
    return mapper_1.copyRunTimeModifier(f, operator_1.pipe(instance_of_array_1.instanceOfArray(), function (name, mixed) {
        var result = mixed;
        var isCopy = false;
        for (var i = 0; i < mixed.length; ++i) {
            /**
             * For now, fail quick for arrays.
             *
             * @todo Should we accumulate errors like in `objectFromMap()`?
             * The array might be too large. How large is too large?
             * Should we accumulate the first `n` errors before throwing?
             */
            var cur = f("" + name + string_util_1.toPropertyAccess(i), mixed[i]);
            //We do not mind === here.
            //If either is a BigInt polyfill, we are okay with the copy.
            if (cur === mixed[i]) {
                continue;
            }
            if (!isCopy) {
                result = result.slice();
                isCopy = true;
            }
            result[i] = cur;
        }
        return result;
    }));
}
exports.array = array;
function readOnlyArray(f) {
    return array(f);
}
exports.readOnlyArray = readOnlyArray;
//# sourceMappingURL=array.js.map